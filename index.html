<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
<title>OpenVoice â€“ Voice Submission</title>

<style>
  body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; background:#f5f6f8; margin:0; }
  .container { max-width:480px; margin:auto; background:#fff; min-height:100vh; padding:24px 20px; box-shadow:0 0 20px rgba(0,0,0,0.05); }

  .header { text-align:center; margin-bottom:20px; }
  .logo { display:flex; justify-content:center; align-items:center; gap:8px; margin-bottom:6px; }
  .logo svg { width:28px; height:28px; }
  .client-name { font-size:22px; font-weight:800; color:#111; }
  .powered { font-size:12px; color:#888; text-transform:uppercase; }

  .trust-box { background:#f0f4f8; padding:12px; font-size:13px; border-radius:8px; color:#445566; margin-bottom:24px; border-left:4px solid #ccdbe8; }

  .type-buttons { display:flex; gap:10px; margin-bottom:20px; }
  .type-buttons button { flex:1; padding:12px; border-radius:8px; border:1px solid #e0e0e0; background:#fff; cursor:pointer; font-weight:500; }
  button.active { background:#eee; border-color:#333; }

  textarea { width:100%; min-height:140px; padding:16px; border-radius:8px; border:2px solid #e0e0e0; resize:none; font-size:16px; }
  textarea:disabled { background:#f9f9f9; }

  .identity-section { border-top:1px solid #eee; padding-top:20px; margin-bottom:20px; }
  .identity-fields { display:none; margin-top:12px; }
  .identity-fields input { width:100%; padding:12px; margin-bottom:10px; border:1px solid #ddd; border-radius:6px; }

  .submit-btn { width:100%; padding:16px; background:#222; color:#fff; border:none; border-radius:8px; font-size:16px; font-weight:700; cursor:pointer; }

  .hidden { display:none; }
</style>
</head>

<body>
<div class="container" id="app">
  <div style="text-align:center; padding-top:100px; color:#888;">Loading OpenVoiceâ€¦</div>
</div>

<script>
const CLIENT_CONFIG = {
  "greenvalley": {
    name: "Green Valley Apartments",
    url: "https://script.google.com/macros/s/AKfycbxioctpkczILIhVgO9t6DgE7hkA9ffAUBo2ZR9qqmgoFHWZuI1uUjlx-_zUxp0H0YEw/exec"
  },
  "fitzone": {
    name: "FitZone Gym",
    url: "https://script.google.com/macros/s/AKfycbwdPeZLHFLVYAY2blP3iKkIypStRzKKh7ng-lABdpZVpX7QAQoZJam0ISrPspnEeOC5cQ/exec"
  }
};

const params = new URLSearchParams(window.location.search);
const clientId = params.get("client");
const app = document.getElementById("app");

if (!clientId || !CLIENT_CONFIG[clientId]) {
  app.innerHTML = `<h3 style="color:red;text-align:center;">Invalid QR Code</h3>`;
  throw new Error("Invalid Client");
}

const CLIENT = CLIENT_CONFIG[clientId];
const API_URL = CLIENT.url;

app.innerHTML = `
  <div id="formArea">
    <div class="header">
      <div class="logo">
        <!-- OpenVoice Logo -->
        <svg viewBox="0 0 24 24" fill="none">
          <path d="M4 10v4a6 6 0 006 6h4a6 6 0 006-6v-4" stroke="#2F80ED" stroke-width="2"/>
          <path d="M12 3v11" stroke="#2F80ED" stroke-width="2"/>
        </svg>
        <div class="client-name">${CLIENT.name}</div>
      </div>
      <div class="powered">Powered by <b>OpenVoice</b></div>
    </div>

    <div class="trust-box">ðŸ”’ Anonymous by default Â· Maintained by a neutral third party</div>

    <div class="type-buttons">
      <button onclick="selectType('Complaint', this)">ðŸ˜¡ Complaint</button>
      <button onclick="selectType('Suggestion', this)">ðŸ’¡ Suggestion</button>
      <button onclick="selectType('Feedback', this)">ðŸ’¬ Feedback</button>
    </div>

    <textarea id="messageBox" placeholder="Select a category aboveâ€¦" disabled></textarea>

    <div class="identity-section">
      <div onclick="toggleIdentity()" style="cursor:pointer;font-weight:500;">Want a reply? (Optional) â–¼</div>
      <div class="identity-fields" id="identityFields">
        <input id="userName" placeholder="Your name">
        <input id="userContact" placeholder="Phone or Email">
      </div>
    </div>

    <button class="submit-btn" id="submitBtn" onclick="submitForm()">Submit</button>
  </div>

  <div id="successArea" class="hidden" style="text-align:center;padding-top:60px;">
    <div style="font-size:48px;">âœ…</div>
    <h2>Your voice has been heard.</h2>
    <p>Your submission was sent securely.</p>
  </div>
`;

let selectedType = null;

function selectType(type, btn) {
  selectedType = type;
  document.querySelectorAll("button").forEach(b => b.classList.remove("active"));
  btn.classList.add("active");
  const t = document.getElementById("messageBox");
  t.disabled = false;
  t.focus();
}

function toggleIdentity() {
  const el = document.getElementById("identityFields");
  el.style.display = el.style.display === "block" ? "none" : "block";
}

function submitForm() {
  const txt = document.getElementById("messageBox");
  if (!selectedType || !txt.value.trim()) return alert("Complete the form");

  const payload = {
    action:"submit",
    type:selectedType,
    message:txt.value.trim(),
    is_anonymous:true,
    name:"",
    contact:""
  };

  const name = userName.value.trim();
  const contact = userContact.value.trim();
  if (name || contact) {
    payload.is_anonymous = false;
    payload.name = name;
    payload.contact = contact;
  }

  submitBtn.innerText = "Sendingâ€¦";
  submitBtn.disabled = true;

  fetch(API_URL, {
    method:"POST",
    mode:"no-cors",
    headers:{ "Content-Type":"application/json" },
    body:JSON.stringify(payload)
  }).then(()=>{
    formArea.classList.add("hidden");
    successArea.classList.remove("hidden");
  });
}
</script>
</body>
</html>
